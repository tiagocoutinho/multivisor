#!/usr/bin/env python

import logging
import socket
import time

logging.basicConfig(level='INFO',
    format="%(asctime)s %(levelname)s %(name)s: %(message)s"
)


def echo(conn, addr):
    logging.info('new connection from %s', addr)
    while True:
        data = conn.recv(1024)
        if data:
            logging.info('recv %s: %r', addr, data)
            conn.sendall(data)
        else:
            logging.warning(f'client %s disconnected', addr)
            break


sock = socket.fromfd(0, socket.AF_INET, socket.SOCK_STREAM)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
while True:
    conn, addr = sock.accept()
    echo(conn, addr)